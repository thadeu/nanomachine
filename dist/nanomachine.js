function t(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function e(){if(!(this instanceof e))return new e;this.events={}}function n(t){if(!(this instanceof n))return new n(t);this.initialProps=t,this.state=t.initial||"idle",this.transitions=t.transitions||[],this.history=new Map,this.events=t.events||{},this.logLevel=t.logLevel?t.logLevel:0,this.emitter=new e,this.createOrUpdateTransitions(this.transitions)}Array.prototype.flatFilter||(Array.prototype.flatFilter=function(t){return this.filter(t).reduce(function(t){return t})}),e.prototype.on=function(t,e){if(t&&e)return(this.events[t]||(this.events[t]=[])).push(e),this;throw new Error("event name and listener is required")},e.prototype.once=function(t,e){var n=this;this.on(t,function i(){e.apply(n,arguments),n.removeListener(t,i)})},e.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments,1),n={event:t},i=[],r=this.events[t];r&&(Array.prototype.push.apply(i,r),i.map(function(t){t.apply(n,e)}))},e.prototype.removeListener=function(t,e){var n=this.events,i=n[t];if(e){var r=Array.prototype.indexOf.call(i,e);-1!==r&&i.splice(r,1)}else n[t]=i.slice();return this},e.prototype.off=function(t,e){e?this.removeListener(t,e):this.events[t]=[]},n.prototype.logger=function(){this.logLevel>0&&console.log.apply(null,Array.prototype.slice.call(arguments))},n.prototype.on=function(t,e){if(!Object.keys(this.events).includes(t))throw new Error("cannot observer transition to "+t);return this.emitter.on(t,e)},n.prototype.createOrUpdateTransitions=function(t){return t.map(function(t){n.prototype[t.name]||(n.prototype[t.name]=function(){return this.transitionTo(t.name)})})},n.prototype.reset=function(){return this.state=this.initialProps.initial,this.history.clear(),this},n.prototype.can=function(t){var e=this.state,n=this.transitions.flatFilter(function(e){return e.name==t});return"*"===n.from||n.from.includes(e)},n.prototype.addHistory=function(t){var e=t.from,n=t.to;this.logger("[nanomachine] @ history added "),this.history.set("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),{from:e,to:n,timestamp:(new Date).toJSON()})},n.prototype.transitionTo=function(e){var n=this.state,i=this.transitions.flatFilter(function(t){return t.name==e});if(!this.can(e))throw new TypeError("cannot "+n+" to "+e);if(t(i,"if")&&!i.if())throw new Error("cannot "+n+" to "+e+" because conditional failed");if(t(i,"unless")&&i.unless())throw new Error("cannot "+n+" to "+e+" because conditional failed");this.state=i.to;var r=this.events[this.state];r&&(this.emitter.emit(this.state,r),this.addHistory({from:n,to:this.state}),this.logger("[nanomachine] @ fired "+this.state))},exports.nanomachine=n,exports.default=n;
//# sourceMappingURL=nanomachine.js.map
