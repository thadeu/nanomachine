!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.nanomachine={})}(this,function(t){function e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function n(){if(!(this instanceof n))return new n;this.events={}}function i(t){if(!(this instanceof i))return new i(t);this.initialProps=t,this.state=t.initial||"idle",this.transitions=t.transitions||[],this.history=new Map,this.events=t.events||{},this.logLevel=t.logLevel?t.logLevel:0,this.emitter=new n,this.createOrUpdateTransitions(this.transitions)}Array.prototype.flatFilter||(Array.prototype.flatFilter=function(t){return this.filter(t).reduce(function(t){return t})}),n.prototype.on=function(t,e){if(t&&e)return(this.events[t]||(this.events[t]=[])).push(e),this;throw new Error("event name and listener is required")},n.prototype.once=function(t,e){var n=this;this.on(t,function i(){e.apply(n,arguments),n.removeListener(t,i)})},n.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments,1),n={event:t},i=[],o=this.events[t];o&&(Array.prototype.push.apply(i,o),i.map(function(t){t.apply(n,e)}))},n.prototype.removeListener=function(t,e){var n=this.events,i=n[t];if(e){var o=Array.prototype.indexOf.call(i,e);-1!==o&&i.splice(o,1)}else n[t]=i.slice();return this},n.prototype.off=function(t,e){e?this.removeListener(t,e):this.events[t]=[]},i.prototype.logger=function(){this.logLevel>0&&console.log.apply(null,Array.prototype.slice.call(arguments))},i.prototype.on=function(t,e){if(!Object.keys(this.events).includes(t))throw new Error("cannot observer transition to "+t);return this.emitter.on(t,e)},i.prototype.createOrUpdateTransitions=function(t){return t.map(function(t){i.prototype[t.name]||(i.prototype[t.name]=function(){return this.transitionTo(t.name)})})},i.prototype.reset=function(){return this.state=this.initialProps.initial,this.history.clear(),this},i.prototype.can=function(t){var e=this.state,n=this.transitions.flatFilter(function(e){return e.name==t});return"*"===n.from||n.from.includes(e)},i.prototype.addHistory=function(t){var e=t.from,n=t.to;this.logger("[nanomachine] @ history added "),this.history.set("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),{from:e,to:n,timestamp:(new Date).toJSON()})},i.prototype.transitionTo=function(t){var n=this.state,i=this.transitions.flatFilter(function(e){return e.name==t});if(!this.can(t))throw new TypeError("cannot "+n+" to "+t);if(e(i,"if")&&!i.if())throw new Error("cannot "+n+" to "+t+" because conditional failed");if(e(i,"unless")&&i.unless())throw new Error("cannot "+n+" to "+t+" because conditional failed");this.state=i.to;var o=this.events[this.state];o&&(this.emitter.emit(this.state,o),this.addHistory({from:n,to:this.state}),this.logger("[nanomachine] @ fired "+this.state))},t.nanomachine=i,t.default=i});
//# sourceMappingURL=nanomachine.umd.js.map
